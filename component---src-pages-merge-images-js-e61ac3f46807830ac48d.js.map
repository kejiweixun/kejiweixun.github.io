{"version":3,"sources":["webpack:///./src/pages/merge-images.js","webpack:///./src/image/delete.svg"],"names":["hStyle","imagesThumbnailStyle","chooseImageBtnStyle","canvasStyle","imageBtnStyle","useState","images","setImages","elementBeingDragged","useEffect","dpr","window","devicePixelRatio","canvas","document","getElementById","ctx","getContext","totalWidth","reduce","a","b","width","totalHeight","height","largestWidth","Math","max","map","image","largestHeight","console","log","style","maxWidth","fillStyle","fillRect","index","sWidth","sHeight","dy","slice","dWidth","dHeight","img","Image","src","url","onload","drawImage","entries","imageToCanvas","onSelectImages","e","files","target","URL","createObjectURL","getImageSize","imageUrl","Promise","resolve","reject","all","file","imagesWithSizeInfo","deleteImage","dataset","imagesTemp","JSON","parse","stringify","splice","onDrag","onDrop","elementBeingSwap","border","index_1","indexOf","index_2","tempElement","onDragOver","preventDefault","onDragEnter","onDragLeave","name","content","css","htmlFor","id","type","onChange","multiple","accept","download","onClick","removeAttribute","outputImage","toDataURL","href","key","draggable","onDragStart","className","deleteIcon","data-index","title","slug","module","exports"],"mappings":"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","file":"component---src-pages-merge-images-js-e61ac3f46807830ac48d.js","sourcesContent":["import React, { useEffect, useState } from \"react\"\nimport Layout from \"../component/layout\"\nimport { css } from \"@emotion/core\"\nimport Helmet from \"react-helmet\"\nimport ISSO from \"../component/comment\"\nimport deleteIcon from '../image/delete.svg'\n\nconst hStyle = css`\n  font-size: 1.6rem;\n  text-align: center;\n  margin: 1rem 0;\n  @media (min-width: 500px) {\n    font-size: 2rem;\n    margin: 2rem 0 1rem 0;\n  }\n`\n\nconst imagesThumbnailStyle = css`\n  margin: 30px 0;\n  display: grid;\n  grid-template-columns: repeat(auto-fit, 80px);\n  grid-gap: 15px;\n  div {\n      display: flex;\n      width: 80px;\n      height: 80px;\n  }\n  .image-thumbnail {\n      object-fit: cover;\n      width: 80px;\n      height: 80px;\n      box-shadow: 0 0 3px grey;\n  }\n  .delete-icon {\n      width: 20px;\n      height: 20px;\n      transform: translate(-10px, -10px);\n  }\n`\n\nconst chooseImageBtnStyle = css`\n  #input-file {\n    visibility:hidden;\n    width: 0px;\n    height: 0px;\n  }\n`\n\nconst canvasStyle = css`\n  display: block;\n  margin: 20px auto;\n`\n\nconst imageBtnStyle = css`\n    font-size: 20px;\n    font-weight: bold;\n    box-sizing: border-box;\n    border: 1px solid grey;\n    padding: 4px 8px;\n    background-color: lightcyan;\n    box-shadow: 0 0 3px grey;\n    text-decoration: none;\n    color: black;\n    display: block;\n    text-align: center;\n    width: 40%;\n    :active {\n        color: red;\n        text-decoration: none;\n    }\n`\n\nconst imageToCanvas = function (images) {\n    const dpr = window.devicePixelRatio;\n    const canvas = document.getElementById('canvas');\n    const ctx = canvas.getContext('2d');\n    const totalWidth = images.reduce((a, b) => a + b.width, 0);\n    const totalHeight = images.reduce((a, b) => a + b.height, 0);\n    const largestWidth = Math.max(...images.map(image => image.width));\n    const largestHeight = Math.max(...images.map(image => image.height));\n    console.log('totalWidth:', totalWidth, 'totalHeight:', totalHeight, 'largestWidth:', largestWidth, 'largestHeight:', largestHeight);\n    canvas.width = largestWidth;\n    canvas.height = totalHeight;\n    canvas.style.width = `${largestWidth / dpr}px`;\n    canvas.style.maxWidth = '70%';\n    canvas.style.height = `${canvas.height / canvas.width * canvas.style.width}px`\n    ctx.fillStyle = 'white';\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n    for (let [index, image] of images.entries()) {\n        const sx = 0;\n        const sy = 0;\n        const sWidth = image.width;\n        const sHeight = image.height;\n        const dx = 0;\n        const dy = images.slice(0, index).reduce((a, b) => a + b.height, 0);\n        const dWidth = image.width;\n        const dHeight = image.height;\n        const img = new Image();\n        img.src = image.url;\n        img.onload = async () => {\n            console.log(img, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight)\n            ctx.drawImage(img, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight);\n        }\n    }\n};\n\nexport default () => {\n    const [images, setImages] = useState([]);\n    var elementBeingDragged = '';\n    useEffect(() => {\n        imageToCanvas(images);\n    }, [images]);\n\n    const onSelectImages = async (e) => {\n        const files = [...e.target.files].map(image => URL.createObjectURL(image));\n        console.log('files:', files)\n        const getImageSize = (imageUrl) => {\n            return new Promise((resolve, reject) => {\n                const img = new Image();\n                img.src = imageUrl;\n                img.onload = () => {\n                    resolve({\n                        width: +img.width,\n                        height: +img.height,\n                        url: img.src\n                    });\n                    reject('出错')\n                }\n            })\n        };\n        const imagesWithSizeInfo = await Promise.all(files.map(file => getImageSize(file)));\n        setImages(imagesWithSizeInfo)\n    };\n\n    const deleteImage = function (e) {\n        const index = e.target.dataset.index;\n        const imagesTemp = JSON.parse(JSON.stringify(images))\n        imagesTemp.splice(index, 1)\n        setImages(imagesTemp)\n    }\n\n    const saveImage = function () {\n        const canvas = document.getElementById('canvas');\n        const a = document.getElementById('download');\n        if (canvas.width === 0) {\n            a.removeAttribute('href')\n        } else {\n            const outputImage = canvas.toDataURL('image/jpeg');\n            a.href = outputImage;\n        }\n    };\n\n    const onDrag = function (e) {\n        elementBeingDragged = e.target;\n    }\n\n    const onDrop = function (e) {\n        const elementBeingSwap = e.target;\n        elementBeingSwap.style.border = 'none';\n        if (elementBeingSwap.src === elementBeingDragged.src) return;\n        const imagesTemp = JSON.parse(JSON.stringify(images));\n        const index_1 = imagesTemp.map(image => image.url).indexOf(elementBeingSwap.src)\n        const index_2 = imagesTemp.map(image => image.url).indexOf(elementBeingDragged.src)\n        const tempElement = imagesTemp[index_1];\n        imagesTemp[index_1] = imagesTemp[index_2];\n        imagesTemp[index_2] = tempElement;\n        setImages(imagesTemp);\n    }\n\n    const onDragOver = function (e) {\n        e.preventDefault();\n    }\n\n    const onDragEnter = function (e) {\n        e.target.style.border = '1px solid red'\n    }\n\n    const onDragLeave = function (e) {\n        e.target.style.border = 'none';\n    }\n\n    return (\n        <Layout>\n            <Helmet>\n                <title>图片拼接 | 长图拼接</title>\n                <meta\n                    name=\"description\"\n                    content=\"图片拼接, 把多张图片合并成一张, 支持纵向或横向拼接, 可以把多张图片拼接成一张长图片, 还能添加水印.\"\n                />\n            </Helmet>\n            <h1 css={hStyle}>图片拼接 | 长图拼接</h1>\n            <section>\n                <div css={chooseImageBtnStyle}>\n                    <label htmlFor=\"input-file\" css={imageBtnStyle}>选择图片</label>\n                    <input id=\"input-file\" type=\"file\" onChange={onSelectImages} multiple accept=\"image/*\"></input>\n                </div>\n                <a download onClick={saveImage} id=\"download\" css={imageBtnStyle}>保存图片</a>\n                <div css={imagesThumbnailStyle}>\n                    {\n                        images.map((image, index) => {\n                            return (\n                                <div key={image.url} draggable=\"true\" onDragStart={onDrag} onDrop={onDrop} onDragOver={onDragOver} onDragEnter={onDragEnter} onDragLeave={onDragLeave}>\n                                    <img src={image.url} className=\"image-thumbnail\"></img>\n                                    <img src={deleteIcon} className=\"delete-icon\" onClick={deleteImage} data-index={index}></img>\n                                </div>\n                            )\n                        })\n                    }\n                </div>\n                <canvas id=\"canvas\" css={canvasStyle} width=\"0px\" height=\"0px\" ></canvas>\n            </section>\n            <ISSO title=\"图片拼接\" slug={`merge-images/`} />\n        </Layout>\n    )\n}","module.exports = \"data:image/svg+xml;base64,PHN2ZyB0PSIxNTk2NzkzNTg0MzU0IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjQ2OTQiIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj48cGF0aCBkPSJNNTEyIDBDMjI5LjM3NiAwIDAgMjI5LjM3NiAwIDUxMnMyMjkuMzc2IDUxMiA1MTIgNTEyIDUxMi0yMjkuMzc2IDUxMi01MTJTNzk0LjYyNCAwIDUxMiAweiBtMjAyLjI0IDY4My41MmMxMC4yNCAxMC4yNCAxMC4yNCAyNi4xMTIgMCAzNi4zNTJzLTI2LjExMiAxMC4yNC0zNi4zNTIgMGwtMTY3LjkzNi0xNjcuOTM2LTE2Ny40MjQgMTY3LjQyNGMtMTAuMjQgMTAuMjQtMjYuMTEyIDEwLjI0LTM2LjM1MiAwcy0xMC4yNC0yNi4xMTIgMC0zNi4zNTJsMTY3LjQyNC0xNjcuNDI0LTE2OC45Ni0xNjkuOTg0Yy0xMC4yNC0xMC4yNC0xMC4yNC0yNi4xMTIgMC0zNi4zNTJzMjYuMTEyLTEwLjI0IDM2LjM1MiAwbDE2OS40NzIgMTY5LjQ3MiAxNjkuOTg0LTE2OS45ODRjMTAuMjQtMTAuMjQgMjYuMTEyLTEwLjI0IDM2LjM1MiAwczEwLjI0IDI2LjExMiAwIDM2LjM1MmwtMTY5Ljk4NCAxNjkuOTg0IDE2Ny40MjQgMTY4LjQ0OHoiIGZpbGw9IiNDRDI5MkEiIHAtaWQ9IjQ2OTUiPjwvcGF0aD48L3N2Zz4=\""],"sourceRoot":""}