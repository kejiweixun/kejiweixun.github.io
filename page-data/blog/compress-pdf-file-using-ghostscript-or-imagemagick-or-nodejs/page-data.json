{"componentChunkName":"component---src-template-blog-post-template-js","path":"/blog/compress-pdf-file-using-ghostscript-or-imagemagick-or-nodejs/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2>为什么要压缩 PDF 文档</h2>\n<p>我用 iPad 扫描了一些文件, 想把它保存在印象笔记, 但文件体积有点大, 同步时间可能有点久. 有很多在线压缩 PDF 文件的网站, 不过需要把文件上传到他们的服务器, 再从他们的服务器下载下来, 效率有点低.</p>\n<p>我需要一种本地压缩 PDF 文件的方法. 我用 Mac, 苹果官网介绍了如何使用<a href=\"https://support.apple.com/zh-sg/guide/preview/prvw1509/mac\">预览应用压缩 PDF</a>, 但压缩后太模糊, 完全不能用. 研究了一番, 找到了一种比较好的方法.</p>\n<h2>如何压缩 PDF 文档, 以 Mac 为例</h2>\n<p>分享三种方法.</p>\n<h3>使用 Ghostscript</h3>\n<ul>\n<li>在电脑本地安装 Ghostscript, Mac 用户可以用 brew 安装, 如果卡在 <code class=\"language-text\">updating homebrew...</code>, <kbd>control</kbd> + <kbd>C</kbd> 一次, 再稍等.</li>\n<li>接着打开 <a href=\"http://www.alfredklomp.com/programming/shrinkpdf/\">Shrinkpdf: shrink PDF files with Ghostscript</a>, 把它提供的 shrinkpdf.sh 文件下载到电脑.</li>\n<li>打开终端应用, 通过 <code class=\"language-text\">cd</code> 进入 shrinkpdf.sh 所在的路径, 然后使用 <code class=\"language-text\">sh shrinkpdf.sh input.pdf output.pdf 144</code> 这样的命令压缩 pdf 文件.</li>\n</ul>\n<p>其中的 input.pdf 是需要压缩的 pdf 文件, output.pdf 是最后生成的文件, 通过 144 设置目标文件的 DPI, 144 是比较理想的值, 数值越小体积越小, 当然也越模糊.</p>\n<h3>使用 imagemagick</h3>\n<p>imagemagick 有很多功能, 可以把 pdf 文件转换成图片, 或者反过来把多个图片合并成一个 pdf, 等等. 当涉及 pdf 操作时, 似乎都需要 Ghostscript 的支持, 所以首先在电脑安装 Ghostscript 和 imagemagick, 用 brew 安装即可.</p>\n<p>imagemagick 压缩 pdf 的思路如下:</p>\n<ul>\n<li>把 pdf 每一页转换成图片: <code class=\"language-text\">convert -density 144 file.pdf image.jpg</code></li>\n<li>压缩图片: <code class=\"language-text\">convert -sampling-factor 4:2:0 -strip -quality 60 -interlace JPEG -colorspace RGB image*.jpg output.jpg</code></li>\n<li>把压缩后的图片重新合并成一个 pdf 文件: <code class=\"language-text\">convert output*.jpg -quality 60 output.pdf</code></li>\n</ul>\n<p>关于压缩图片所使用的 <code class=\"language-text\">-sampling-factor 4:2:0 -strip -quality 60 -interlace JPEG -colorspace RGB</code>, 可参考<a href=\"https://stackoverflow.com/questions/7261855/recommendation-for-compressing-jpg-files-with-imagemagick\">stackoverflow</a>的一个问答.</p>\n<p>使用 imagemagick 压缩 pdf 有一个大缺点. 如果这个 pdf 是扫描件, 这样压缩效果很好, 但是如果 pdf 的内容是矢量内容, 例如 word 文档转换过来的等等, 这样反而会增加生成的 pdf 文件的体积. 因为 imagemagick 把矢量内容栅格化了, 页面都变成了图片, 而 shrinkpdf.sh 不存在这个问题.</p>\n<h3>NodeJS</h3>\n<p>单纯用 nodejs 我没有找到很好的压缩 pdf 的方法, 比较推荐的做法是:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">const <span class=\"token punctuation\">{</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> require<span class=\"token punctuation\">(</span><span class=\"token string\">'child_process'</span><span class=\"token punctuation\">)</span>\nexec<span class=\"token punctuation\">(</span><span class=\"token string\">'sh shrinkpdf.sh input.pdf output.pdf 144'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p> 归根到底还是用 Ghostscript, 所以如果你在 nodejs 服务器应用这种方法, 需要先在服务器安装 Ghostscript 和 imagemagick.</p>\n<h3>如何让 PDF 看起来是扫描出来的样子</h3>\n<p> 2020/05/16 补充.</p>\n<p> Hacker News 有一个<a href=\"https://news.ycombinator.com/item?id=23157408&#x26;utm_term=comment\">帖子</a>分享了多种把 PDF 转换成看起来是用扫描仪扫描出来的样子的方法, 例如:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">convert -density 150 ORIGINAL.pdf -colorspace gray +noise Gaussian -rotate 0.5 -depth 2 SCANNED.pdf</code></pre></div>","frontmatter":{"title":"如何压缩 PDF 文件, imagemagick, Ghostscript, NodeJS","date":"2020/04/11","slug":"compress-pdf-file-using-ghostscript-or-imagemagick-or-nodejs","description":null}}}]}},"pageContext":{"slug":"compress-pdf-file-using-ghostscript-or-imagemagick-or-nodejs"}}}