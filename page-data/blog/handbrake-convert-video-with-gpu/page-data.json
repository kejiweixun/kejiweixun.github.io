{"componentChunkName":"component---src-template-blog-post-template-js","path":"/blog/handbrake-convert-video-with-gpu/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p>HandBrake 是一款格式转换工具，我通常用它来把非 mp4 的视频转换成 mp4 格式，顺便压缩体积以方便网络传播。</p>\n<p>HandBrake 在最近的版本中增加了硬件编码功能，转换格式时可以让 GPU 参与工作，我测试了一下，这样能大幅缩短转换时间。</p>\n<p>打开 HandBrake，在界面中间选择 Video 标签，接着点击 Video Encoder 菜单，这里列出了多种编码方式。</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"color: grey; font-size: 0.8rem; text-align: center; margin: 2rem auto; padding: 0; border: 1px solid #eee\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 76.57142857142857%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAddsJKD/xAAXEAADAQAAAAAAAAAAAAAAAAABEBEg/9oACAEBAAEFAlBj/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGhAAAgIDAAAAAAAAAAAAAAAAAAEQETGR8P/aAAgBAQABPyGlgSRxcaj/2gAMAwEAAgADAAAAEBPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHBAAAgMAAwEAAAAAAAAAAAAAAAERIZFBUWGx/9oACAEBAAE/EIHR16dAm4eiE9Jar4Mw/9k='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/b56a94a7ad483c9050d3a06231edcce8/c54d4/encoder-list.webp 175w,\n/static/b56a94a7ad483c9050d3a06231edcce8/a3432/encoder-list.webp 350w,\n/static/b56a94a7ad483c9050d3a06231edcce8/426ac/encoder-list.webp 700w,\n/static/b56a94a7ad483c9050d3a06231edcce8/8af20/encoder-list.webp 884w\"\n          sizes=\"(max-width: 700px) 100vw, 700px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/b56a94a7ad483c9050d3a06231edcce8/e52aa/encoder-list.jpg 175w,\n/static/b56a94a7ad483c9050d3a06231edcce8/70ebb/encoder-list.jpg 350w,\n/static/b56a94a7ad483c9050d3a06231edcce8/29d31/encoder-list.jpg 700w,\n/static/b56a94a7ad483c9050d3a06231edcce8/e3528/encoder-list.jpg 884w\"\n          sizes=\"(max-width: 700px) 100vw, 700px\"\n          type=\"image/jpeg\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/b56a94a7ad483c9050d3a06231edcce8/29d31/encoder-list.jpg\"\n          alt=\"encoder-list\"\n          title=\"encoder-list\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">encoder-list</figcaption>\n  </figure></p>\n<p>其中带有 <a href=\"https://handbrake.fr/docs/en/latest/technical/video-videotoolbox.html\">VideoToolbox</a> 的就是启用了 GPU 编码的选项，上面这样截图是在 mac 上显示的列表。</p>\n<p>如果你是 win 或 linux 系统，并且 GPU 是 Nvidia，那可能 NVEnc；如果是 AMD 的 GPU，则是 VEC；如果是 intel 的 GPU，可能是 QSV (QuickSync Video)。</p>\n<p>我分别使用 H.264(x264) 和 H.264(VideoToolbox) 对同一个视频进行格式转换，所用时间分别是 16 分 45 秒、5 分 25 秒。结论很明显，开启 GPU 会大幅缩短转换时间。</p>\n<p>使用 H.264(x264) 编码时，电脑的 CPU、GPU 使用率如下：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; color: grey; font-size: 0.8rem; text-align: center; margin: 2rem auto; padding: 0; border: 1px solid #eee\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.28571428571428%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAdpSFL//xAAXEAADAQAAAAAAAAAAAAAAAAAAAREQ/9oACAEBAAEFAoQWo//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABcQAAMBAAAAAAAAAAAAAAAAAAABMSD/2gAIAQEABj8CrK8//8QAGhAAAgIDAAAAAAAAAAAAAAAAAAEhMRARYf/aAAgBAQABPyGbeDUtsps3wSD/2gAMAwEAAgADAAAAEL/P/8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQMBAT8Qh//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAECAQE/EKf/xAAcEAEAAgIDAQAAAAAAAAAAAAABACFBURExYeH/2gAIAQEAAT8QOUSt6YVcPsKZzcFqZ3Od7e/IjhP/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/b83bb37be9eb85a534a807ab6751edd8/c54d4/usage-with-hardware-encoder.webp 175w,\n/static/b83bb37be9eb85a534a807ab6751edd8/a3432/usage-with-hardware-encoder.webp 350w,\n/static/b83bb37be9eb85a534a807ab6751edd8/426ac/usage-with-hardware-encoder.webp 700w,\n/static/b83bb37be9eb85a534a807ab6751edd8/c139f/usage-with-hardware-encoder.webp 1050w,\n/static/b83bb37be9eb85a534a807ab6751edd8/f13ee/usage-with-hardware-encoder.webp 1072w\"\n          sizes=\"(max-width: 700px) 100vw, 700px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/b83bb37be9eb85a534a807ab6751edd8/e52aa/usage-with-hardware-encoder.jpg 175w,\n/static/b83bb37be9eb85a534a807ab6751edd8/70ebb/usage-with-hardware-encoder.jpg 350w,\n/static/b83bb37be9eb85a534a807ab6751edd8/29d31/usage-with-hardware-encoder.jpg 700w,\n/static/b83bb37be9eb85a534a807ab6751edd8/9ecec/usage-with-hardware-encoder.jpg 1050w,\n/static/b83bb37be9eb85a534a807ab6751edd8/67471/usage-with-hardware-encoder.jpg 1072w\"\n          sizes=\"(max-width: 700px) 100vw, 700px\"\n          type=\"image/jpeg\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/b83bb37be9eb85a534a807ab6751edd8/29d31/usage-with-hardware-encoder.jpg\"\n          alt=\"usage with hardware encoder\"\n          title=\"usage with hardware encoder\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n    </span></p>\n<p>使用 H.264(VideoToolbox) 编码时，电脑的 CPU、GPU 使用率如下：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; color: grey; font-size: 0.8rem; text-align: center; margin: 2rem auto; padding: 0; border: 1px solid #eee\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.28571428571428%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHtTRKF/8QAFhABAQEAAAAAAAAAAAAAAAAAEQAg/9oACAEBAAEFAiM//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFxAAAwEAAAAAAAAAAAAAAAAAAAExIP/aAAgBAQAGPwKsrz//xAAYEAEBAQEBAAAAAAAAAAAAAAABABExIf/aAAgBAQABPyH3sc0GHW4tsal//9oADAMBAAIAAwAAABDsz//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/EIf/xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAgEBPxCn/8QAGxABAAMAAwEAAAAAAAAAAAAAAQARITFBUZH/2gAIAQEAAT8QE2lvTBlz6xg2vdluQ59gqRCuth6Hk//Z'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/c2aff4189daab2de918743259333df0d/c54d4/usage-without-hardware-encoder.webp 175w,\n/static/c2aff4189daab2de918743259333df0d/a3432/usage-without-hardware-encoder.webp 350w,\n/static/c2aff4189daab2de918743259333df0d/426ac/usage-without-hardware-encoder.webp 700w,\n/static/c2aff4189daab2de918743259333df0d/c139f/usage-without-hardware-encoder.webp 1050w,\n/static/c2aff4189daab2de918743259333df0d/f13ee/usage-without-hardware-encoder.webp 1072w\"\n          sizes=\"(max-width: 700px) 100vw, 700px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/c2aff4189daab2de918743259333df0d/e52aa/usage-without-hardware-encoder.jpg 175w,\n/static/c2aff4189daab2de918743259333df0d/70ebb/usage-without-hardware-encoder.jpg 350w,\n/static/c2aff4189daab2de918743259333df0d/29d31/usage-without-hardware-encoder.jpg 700w,\n/static/c2aff4189daab2de918743259333df0d/9ecec/usage-without-hardware-encoder.jpg 1050w,\n/static/c2aff4189daab2de918743259333df0d/67471/usage-without-hardware-encoder.jpg 1072w\"\n          sizes=\"(max-width: 700px) 100vw, 700px\"\n          type=\"image/jpeg\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/c2aff4189daab2de918743259333df0d/29d31/usage-without-hardware-encoder.jpg\"\n          alt=\"usage without hardware encoder\"\n          title=\"usage without hardware encoder\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n    </span></p>\n<p>截图显示，没有使用 hardware encoder 时，电脑 CPU 的使用率接近 95%，GPU 是 0%。开启 hardware encoder，CPU 使用率虽然有所下降，但依然很高，大概为 86%，这时 GPU 的确发挥了作用，使用率是 15% 左右。</p>\n<p>另一个有趣数据是，H.264(x264) 和 H.264(VideoToolbox) 获得的视频体积分别是 318MB、632MB。虽然除了编码方式之外我没有更改任何其他设置，但获得的两个视频，其码率并不相同，分别是 3.05Mbps、6.07Mbps，这导致了视频体积的差异。</p>\n<p>Linus <a href=\"https://www.youtube.com/watch?v=4MkrEMjPk24\">评测 M1 电脑</a>时，分别用 HandBrake 的 software encode 和 hardware encode 测试了 M1、intel、amd 电脑，结果显示 hardware encode 都能明显缩短转换时间：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; color: grey; font-size: 0.8rem; text-align: center; margin: 2rem auto; padding: 0; border: 1px solid #eee\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100.57142857142858%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBP/EABcBAQEBAQAAAAAAAAAAAAAAAAABAgP/2gAMAwEAAhADEAAAAeKozfCQs6SyD//EABgQAAMBAQAAAAAAAAAAAAAAAAEQEQAC/9oACAEBAAEFAucYg6//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAVEAEBAAAAAAAAAAAAAAAAAAAgMf/aAAgBAQAGPwIQ/wD/xAAbEAEBAAEFAAAAAAAAAAAAAAABABEQITFBgf/aAAgBAQABPyHCXB0Iyj0vCGbTZv/aAAwDAQACAAMAAAAQf8i+/8QAFxEBAAMAAAAAAAAAAAAAAAAAEQEgMf/aAAgBAwEBPxAZ2n//xAAWEQADAAAAAAAAAAAAAAAAAAARICH/2gAIAQIBAT8QMT//xAAcEAEAAgMAAwAAAAAAAAAAAAABACERQVEx0eH/2gAIAQEAAT8QKVQa3D+mKZcNRzwFZqOcJXygSGmok3F9n//Z'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/79d9c7df4a50f1a375d6d2c36d472697/c54d4/comp.webp 175w,\n/static/79d9c7df4a50f1a375d6d2c36d472697/a3432/comp.webp 350w,\n/static/79d9c7df4a50f1a375d6d2c36d472697/426ac/comp.webp 700w,\n/static/79d9c7df4a50f1a375d6d2c36d472697/c139f/comp.webp 1050w,\n/static/79d9c7df4a50f1a375d6d2c36d472697/bfc0a/comp.webp 1326w\"\n          sizes=\"(max-width: 700px) 100vw, 700px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/79d9c7df4a50f1a375d6d2c36d472697/e52aa/comp.jpg 175w,\n/static/79d9c7df4a50f1a375d6d2c36d472697/70ebb/comp.jpg 350w,\n/static/79d9c7df4a50f1a375d6d2c36d472697/29d31/comp.jpg 700w,\n/static/79d9c7df4a50f1a375d6d2c36d472697/9ecec/comp.jpg 1050w,\n/static/79d9c7df4a50f1a375d6d2c36d472697/bbf30/comp.jpg 1326w\"\n          sizes=\"(max-width: 700px) 100vw, 700px\"\n          type=\"image/jpeg\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/79d9c7df4a50f1a375d6d2c36d472697/29d31/comp.jpg\"\n          alt=\"comp\"\n          title=\"comp\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n    </span></p>\n<hr>\n<p>参考文章：<a href=\"https://www.ryananddebi.com/2020/06/26/handbrake-convert-files-with-gpu-nvenc-rather-than-cpu/\">HandBrake – Convert Files with GPU/Nvenc Rather than CPU</a></p>","frontmatter":{"title":"HandBrake 使用 GPU 转换视频格式，可大幅缩短时间","date":"2020/12/01","slug":"handbrake-convert-video-with-gpu","description":null}}}]}},"pageContext":{"slug":"handbrake-convert-video-with-gpu"}},"staticQueryHashes":["1518281631"]}